const fs = require("fs");
const path = require("path");

const rootDir = path.resolve(__dirname, "../../");
const environments = ["development", "staging", "production", "test"];
for (let i = 0; i < environments.length; i++) {
  const env = environments[i];
  const envJsonFilePath = path.join(rootDir, `vault/env.${env}.json`);
  if (fs.existsSync(envJsonFilePath)) {
    const envConfig = JSON.parse(fs.readFileSync(envJsonFilePath, "utf8"));
    let message = "# This file is automatically generated by running \n";
    message += `# this command "node bin/envars/create.js"\n`;
    const envVars =
      message +
      Object.keys(envConfig)
        .map((key) => {
          const value = envConfig[key];
          if (value !== null) {
            if (typeof value === "string") {
              return `export ${key} = "${value}"\n`;
            } else if (
              typeof value === "number" ||
              typeof value === "boolean"
            ) {
              return `export ${key} = ${value}\n`;
            } else {
              throw new Error(
                `Unsupported type for environment variable: ${key}`
              );
            }
          }
          return null;
        })
        .join("");
    const envFilePath = path.join(rootDir, `.env.${env}`);
    fs.writeFileSync(envFilePath, envVars);
  } else {
    console.log(`Environment file not found: ${envJsonFilePath}`);
  }
}
